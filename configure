#!/bin/sh
usage() {
cat <<EOF
usage: configure [-h | --help] [-g | --debug] [-n | --no-stepping]
EOF
}
die () {
  echo "configure: error: $*" 1>&2
  exit 1
}
msg () {
  echo "[configure] $*"
}
debug=no
stepping=yes
while [ $# -gt 0 ]
do
  case "$1" in
    -h | --help) usage; exit 0;;
    -g | --debug) debug=yes;;
    -n | --no-stepping) stepping=no;;
    *) die "invalid option '$1' (try '-h')";;
  esac
  shift
done
COMPILE="gcc -Wall"
if [ $debug = yes ]
then
  COMPILE="$COMPILE -g"
else
  COMPILE="$COMPILE -O3 -DNDEBUG"
fi
[ $stepping = no ] && COMPILE="$COMPILE -DNSTEPPING"
msg "compiling with '$COMPILE'"
sed -e "s#@COMPILE@#$COMPILE#" makefile.in > makefile
msg "generated 'makefile' (run 'make')"
